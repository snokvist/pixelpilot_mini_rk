; PixelPilot Mini configuration focused on exercising the external OSD bridge.
; Based on config/osd-sample.ini but with an extended OSD layout that renders
; every external text slot and plots a few numeric values for quick validation.

[drm]
card = /dev/dri/card0
connector = HDMI-A-1
video-plane-id = 76
use-udev = true
osd-plane-id = 0

[udp]
port = 5600
video-pt = 97
audio-pt = 98

[pipeline]
appsink-max-buffers = 8
custom-sink = receiver
pt97-filter = true

[idr]
enable = true
port = 80
path = /request/idr
timeout-ms = 200

[sse]
enable = true
bind = 0.0.0.0
port = 8082
interval-ms = 1000

[splash]
enable = true
input = assets/spinner_ai_1080p30.h265
fps = 30.0
idle-timeout-ms = 5000
default-sequence = intro

[splash.sequence.intro]
start = 0
end = 140

[audio]
device = plughw:CARD=rockchiphdmi0,DEV=0
disable = false
optional = true

[record]
enable = false
path = /media
mode = fragmented

[restarts]
limit = 3
window-ms = 2000

[gst]
log = false

[cpu]
affinity = 1,2,3

[osd]
enable = true
refresh-ms = 100
plane-id = 0
; Include the default stats alongside the external bridge helpers so the layout
; remains informative when toggling between sample configurations while staying
; within the eight element limit enforced by the renderer.
elements = stats, recording_indicator, framesize_plot, bitrate_plot, external_bridge_text, external_value1_plot, external_value2_plot, external_value3_plot

[osd.external]
; Enable the UNIX socket bridge explicitly so running this config immediately
; binds the socket for test publishers.
enable = true
socket = /run/pixelpilot/osd.sock

[osd.element.stats]
type = text
anchor = top-left
padding = 8
background = transparent-grey
border = transparent-white
foreground = white
line = HDMI {display.mode} plane={drm.video_plane_id}
line = UDP port={udp.port} PTv={udp.vid_pt} PTa={udp.aud_pt} sinkbuf={pipeline.appsink_max_buffers}
line = Record {record.state} active={record.active} dur={record.duration_hms} size={record.megabytes}MiB
line = Pipeline {pipeline.state} restarts={pipeline.restart_count}{pipeline.audio_suffix}
line = RTP vpkts={udp.video_packets} loss={udp.lost_packets} reo={udp.reordered_packets} dup={udp.duplicate_packets}
line = Jitter {udp.jitter.latest_ms}/{udp.jitter.avg_ms}ms bitrate {udp.bitrate.latest_mbps}/{udp.bitrate.avg_mbps}Mbps
line = IDR req={udp.idr_requests}
line = Frames={udp.frames.count} incomplete={udp.frames.incomplete} avg={udp.frames.avg_bytes}KB last={udp.frames.last_bytes}KB
line = Seq={udp.expected_sequence}

[osd.element.recording_indicator]
type = text
anchor = top-right
offset = -16,16
padding = 6
background = transparent-grey
border = transparent-white
foreground = red
line = {record.indicator}

[osd.element.bitrate_plot]
type = bar
anchor = bottom-left
offset = 0,-12
size = 360x90
sample-spacing = 12
bar-width = 8
metric = udp.bitrate.latest_mbps
label = Bitrate (Mbit/s)
foreground = blue
background = transparent-grey
grid = transparent-white

[osd.element.framesize_plot]
type = bar
anchor = bottom-left
offset = 380,-12
size = 360x90
sample-spacing = 12
bar-width = 8
metric = udp.frames.last_bytes
label = Frame Size (Bytes)
foreground = cyan
background = transparent-grey
grid = transparent-white

[osd.element.external_bridge_text]
type = text
anchor = mid-right
offset = -16,0
padding = 8
background = transparent-grey
border = transparent-white
foreground = light-grey
line = External feed: {ext.status}
line = text1: {ext.text1}
line = text2: {ext.text2}
line = text3: {ext.text3}
line = text4: {ext.text4}
line = text5: {ext.text5}
line = text6: {ext.text6}
line = text7: {ext.text7}
line = text8: {ext.text8}
line = value1: {ext.value1}
line = value2: {ext.value2}
line = value3: {ext.value3}
line = value4: {ext.value4}
line = value5: {ext.value5}
line = value6: {ext.value6}
line = value7: {ext.value7}
line = value8: {ext.value8}

[osd.element.external_value1_plot]
type = line
anchor = bottom-mid
offset = 0,-12
size = 320x120
sample-spacing = 4
metric = ext.value1
label = ext.value1
info-box = true
line-color = green
background = transparent-grey
grid = transparent-white

[osd.element.external_value2_plot]
type = line
anchor = bottom-mid
offset = 340,-12
size = 320x120
sample-spacing = 4
metric = ext.value2
label = ext.value2
info-box = true
line-color = orange
background = transparent-grey
grid = transparent-white

[osd.element.external_value3_plot]
type = line
anchor = bottom-mid
offset = -340,-12
size = 320x120
sample-spacing = 4
metric = ext.value3
label = ext.value3
info-box = true
line-color = purple
background = transparent-grey
grid = transparent-white
